<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Summary Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            padding: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 400px;
        }
        
        .summary-container {
            position: relative;
        }
        
        .summary-text {
            color: #6c757d;
            line-height: 1.6;
            word-wrap: break-word;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.5;
            max-height: 6em;
            margin-bottom: 0.5rem;
        }
        
        .read-more-btn {
            transition: all 0.3s ease;
            background: rgba(102, 126, 234, 0.2) !important;
            border: 2px solid #667eea !important;
            color: #667eea !important;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }
        
        .read-more-btn:hover {
            background: rgba(102, 126, 234, 0.3) !important;
            color: #5a6ac7 !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <h1>Debug Summary Test</h1>
    
    <div class="card">
        <h3>Test Article</h3>
        <div class="summary-container">
            <p class="summary-text collapsed">This is a test summary that should be truncated after four lines. It contains multiple sentences to ensure that the text is long enough to be truncated. The read more button should appear and clicking it should expand the text to show the full content. This tests whether the JavaScript functionality is working correctly in the newspaper detail template.</p>
            <div style="text-align: center; margin-top: 0.5rem;">
                <button class="read-more-btn">ðŸ“– Read More</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize summary functionality
        let buttonsInitialized = false;

        function initializeSummaryButtons() {
            if (buttonsInitialized) {
                console.log('Buttons already initialized, skipping...');
                return;
            }
            
            const readMoreBtns = document.querySelectorAll('.read-more-btn');
            console.log('Found', readMoreBtns.length, 'read more buttons');
            
            readMoreBtns.forEach((btn, index) => {
                console.log('Setting up button', index, ':', btn.textContent);
                
                // Remove any existing event listeners
                btn.removeEventListener('click', handleButtonClick);
                
                // Add new event listener
                btn.addEventListener('click', handleButtonClick);
                
                // Add a data attribute to track if it's been initialized
                btn.setAttribute('data-initialized', 'true');
            });
            
            buttonsInitialized = true;
            console.log('Buttons initialization completed');
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing summary buttons...');
            initializeSummaryButtons();
        });

        // Fallback initialization on window load (only if not already initialized)
        window.addEventListener('load', function() {
            console.log('Window loaded, initializing summary buttons...');
            if (!buttonsInitialized) {
                initializeSummaryButtons();
            }
        });

        function handleButtonClick(event) {
            console.log('Button clicked:', this.textContent);
            event.preventDefault();
            event.stopPropagation();
            toggleSummary(this, event);
        }

        // Toggle summary text expansion
        function toggleSummary(button, event) {
            console.log('toggleSummary called');
            event.preventDefault();
            event.stopPropagation();
            
            const summaryContainer = button.closest('.summary-container');
            const summaryText = summaryContainer.querySelector('.summary-text');
            
            console.log('Summary text element:', summaryText);
            console.log('Current classes:', summaryText.className);
            
            // Check if currently expanded or collapsed
            const hasExpandedClass = summaryText.classList.contains('expanded');
            const hasCollapsedClass = summaryText.classList.contains('collapsed');
            
            console.log('Has expanded class:', hasExpandedClass);
            console.log('Has collapsed class:', hasCollapsedClass);
            
            if (hasExpandedClass) {
                // Collapse the summary
                console.log('Collapsing summary');
                summaryText.classList.remove('expanded');
                summaryText.classList.add('collapsed');
                button.innerHTML = 'ðŸ“– Read More';
            } else {
                // Expand the summary
                console.log('Expanding summary');
                summaryText.classList.remove('collapsed');
                summaryText.classList.add('expanded');
                button.innerHTML = 'ðŸ“– Read Less';
            }
            
            console.log('After toggle - classes:', summaryText.className);
        }
    </script>
</body>
</html>
